<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.35">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Lifecycle | Muban</title><meta name="description" content="Writing components for server-rendered HTML">
    <link rel="modulepreload" href="/muban/assets/app.7a437beb.js"><link rel="modulepreload" href="/muban/assets/lifecycle.html.49387454.js"><link rel="modulepreload" href="/muban/assets/lifecycle.html.7e57011f.js"><link rel="modulepreload" href="/muban/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/muban/assets/style.f8dfe95e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/muban/" class=""><!----><span class="site-name">Muban</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/muban/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a href="/muban/guide/" class="" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-item"><a href="/muban/api/" class="" aria-label="Api"><!--[--><!--]--> Api <!--[--><!--]--></a></div><div class="navbar-item"><a href="/muban/changelog/" class="" aria-label="Changelog"><!--[--><!--]--> Changelog <!--[--><!--]--></a></div><div class="navbar-item"><a href="/muban/research/" class="router-link-active" aria-label="Research"><!--[--><!--]--> Research <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/mubanjs/muban" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/muban/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a href="/muban/guide/" class="" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-item"><a href="/muban/api/" class="" aria-label="Api"><!--[--><!--]--> Api <!--[--><!--]--></a></div><div class="navbar-item"><a href="/muban/changelog/" class="" aria-label="Changelog"><!--[--><!--]--> Changelog <!--[--><!--]--></a></div><div class="navbar-item"><a href="/muban/research/" class="router-link-active" aria-label="Research"><!--[--><!--]--> Research <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/mubanjs/muban" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a aria-current="page" href="/muban/research/lifecycle.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="Lifecycle"><!--[--><!--]--> Lifecycle <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/muban/research/lifecycle.html#current-order" class="router-link-active router-link-exact-active sidebar-item" aria-label="current order"><!--[--><!--]--> current order <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/muban/research/lifecycle.html#questions" class="router-link-active router-link-exact-active sidebar-item" aria-label="questions"><!--[--><!--]--> questions <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/muban/research/lifecycle.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="Lifecycle"><!--[--><!--]--> Lifecycle <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/muban/research/lifecycle.html#current-order" class="router-link-active router-link-exact-active sidebar-item" aria-label="current order"><!--[--><!--]--> current order <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/muban/research/lifecycle.html#questions" class="router-link-active router-link-exact-active sidebar-item" aria-label="questions"><!--[--><!--]--> questions <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/muban/research/component-props.html" class="sidebar-item sidebar-heading" aria-label="Component Props"><!--[--><!--]--> Component Props <!--[--><!--]--></a><!----></li><li><a href="/muban/research/component-refs.html" class="sidebar-item sidebar-heading" aria-label="Component Refs"><!--[--><!--]--> Component Refs <!--[--><!--]--></a><!----></li><li><a href="/muban/research/component-dynamic-templates.html" class="sidebar-item sidebar-heading" aria-label="Dynamic Templates"><!--[--><!--]--> Dynamic Templates <!--[--><!--]--></a><!----></li><li><a href="/muban/research/reactivity.html" class="sidebar-item sidebar-heading" aria-label="Exploring reactivity"><!--[--><!--]--> Exploring reactivity <!--[--><!--]--></a><!----></li><li><a href="/muban/research/pure-rendering.html" class="sidebar-item sidebar-heading" aria-label="Pure rendering"><!--[--><!--]--> Pure rendering <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="lifecycle" tabindex="-1"><a class="header-anchor" href="#lifecycle" aria-hidden="true">#</a> Lifecycle</h1><h2 id="current-order" tabindex="-1"><a class="header-anchor" href="#current-order" aria-hidden="true">#</a> current order</h2><ol><li><p>Render component template</p></li><li><p>Init component DOM element</p><ol><li><p>resolve props from sources</p></li><li><p>resolve refs from config &gt; DOM</p><ol><li>for elements/collections - query the DOM for the element(s)</li><li>for component bindings - create child components (recursion at step 2 above)</li></ol></li><li><p>watch for mutation changes in DOM to update refs or create new components (step 2 above)</p></li><li><p>make lifecycle registration active</p></li><li><p>call setup function (return bindings)</p><ol><li>get access to props and refs</li><li>firing of parent callback functions won&#39;t work at this point, they are undefined</li><li>return binding definitions</li></ol></li><li><p>deactivate lifecycle registration</p></li><li><p>apply bindings</p><ol><li><p>for elements/collections - apply DOM bindings</p></li><li><p>for component bindings - call setProps for all defined props (incl passing callback functions)</p></li><li><p>for template bindings:</p><ol><li><p>extract data (optionally)</p></li><li><p>render template with currently active data</p><ul><li>this will update the DOM, triggering step &quot;iii&quot;</li></ul></li><li><p>watch for new data, and re-do step &quot;b&quot;</p></li></ol></li></ol></li><li><p>call mount lifecycle</p></li><li><p>return component API (name, setProps, dispose)</p></li></ol></li></ol><h2 id="questions" tabindex="-1"><a class="header-anchor" href="#questions" aria-hidden="true">#</a> questions</h2><ul><li><p><strong>Q:</strong> When can we execute &quot;initial&quot; callback functions to the parent</p><p><strong>A:</strong> when setProps has been called, when applying the parent bindings, but its parent is not yet fully constructed</p><p><strong>P:</strong> The problem with the above, is that the component is constructed when only the HTML props are available, but not the parent props. They come in a bit later (same frame), but it means that the callback functions are not available yet in the setup function.</p></li><li><p><strong>Q:</strong> How do we deal with props that we want to set on change, but not initially?</p><p><strong>A:</strong> Find a way to get access to the props from the child component to correctly get the value in the parent component when setting up the binding.</p><p><strong>P:</strong> Props have 2 sources, the HTML and the parent component. For &quot;data&quot; props, the one from the HTML are always leading and more important, but only initially.<br> After initial setup, when interacting with the UI, things can change, and props might need to be updated. The problem with this, is that the binding setup is done just once, and it should already contain this prop binding, with an initial value, that might override the value from the HTML. So it&#39;s key to get value of the prop that you&#39;re trying to set correct with the initial value, and this initial value has to come from the child.</p></li><li><p><strong>Q:</strong> If we expose props from child to parent, should they be reactive? <strong>A:</strong> Probably set them based on initial HTML props, and update them if they are accessed later to reflect the correct value, but not make them reactive or update the HTML. <strong>P:</strong> We have a few options:</p><ol><li>Set them based on initial HTML props</li><li>Update them as they are changed from the parent, but not reactive</li><li>Make them fully reactive as well, so they can be &quot;watched&quot;</li><li>As an addition to i or ii, also update the HTML</li><li>As an addition, have the props being update whenever the HTML is changed later.</li></ol><p>So the minimum we need is option &quot;i&quot;, to sync up the correct initial state from child to parent. In that scenario we would only use them to initialize our observables in the setup function. If they are used in any async code (watch, callbacks), they might be incorrect / stale, so this can never be used like that.</p><p>To support updated props in async code, we would need to update the exposed props whenever the parent changes them. This used case is probably very seldom, since you could have already stored them locally in the setup function.</p><p>Making props reactive might make things more complex:</p><ul><li>It enables 2 ways on how to listen for changes (through callbacks, and watching props)</li><li>It could result in infinite recursion (since bindings can set props, they would trigger the watch, which could update the bindings again).</li></ul><p>So it&#39;s probably not a good idea to enable this.</p><p>Then we have 2 related additional options, if we should update the HTML to reflect the internal state of the component, and if we should update the props when any html (through other means) is updated. Doing this could also result in recursion. But more importantly, it would &quot;move&quot; the logic to keep using and mutating props in the component, which is probably not good practice. So we&#39;ll ignore this for now.</p></li><li><p><strong>Q:</strong> Do we need an &quot;adopted&quot; lifecycle hook? Would it trigger on Parent or Root adoption? Do we need both? Should we &quot;delay&quot; the &quot;mount&quot; lifecycle hook? Of have &quot;created&quot;, &quot;mounted&quot; and &quot;adopted&quot;?</p><p><strong>A:</strong> Not sure, if we want to be extensive, we would have; setup(1), created(2), mounted(3) and adopted(4). If we want to be minimal, we would have; setup(1) and mounted(4).</p><p><strong>P:</strong> We have 3 &quot;moment&quot; in the creation process of a component. Since components are created as part the parent creation, it&#39;s always &quot;completed&quot; earlier than the parent. This means we have the moment where a component itself is created, we have the moment where its parent is created as well (and we receive their props, e.g. callbacks), and we have the moment the whole app is created (up to the root component). In most cases, we only care about the component in isolation, so we can use the first one. In some cases, we might need something from the parent (e.g. calling a function passed through the props), which we can only do when the parent has been fully created. And in other cases, we need access to the root, global state, etc to be set up correctly.</p><p>Timing wise, these should all happen in the same frame, since the creation process is all synchronous (it&#39;s just that other stuff happens in between). We could just chose the have 1 hook (when the root has been created), and use that for everything.</p><p>We already have the setup function itself, so the current &quot;mounted&quot; has not much additional value in its current state. Only difference is that bindings are applied, so manual DOM mutations will update correctly. It could be useful if we ever want to delay child component creation to the &quot;applyBindings&quot; phase, and only have those instances accessible in the mount hook.</p></li></ul><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/mubanjs/muban/edit/main/docs/research/lifecycle.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: thanarie@gmail.com">Arjan van Wijk</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a aria-current="page" href="/muban/research/lifecycle.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Lifecycle"><!--[--><!--]--> Lifecycle <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/muban/assets/app.7a437beb.js" defer></script>
  </body>
</html>
