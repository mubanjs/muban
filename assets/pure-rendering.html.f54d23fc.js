import{r as t,o as e,c as p,b as n,d as o,F as c,a as l,e as a}from"./app.7a437beb.js";import{_ as u}from"./plugin-vue_export-helper.21dcd24c.js";const i={},r=l(`<h1 id="pure-rendering" tabindex="-1"><a class="header-anchor" href="#pure-rendering" aria-hidden="true">#</a> Pure rendering</h1><p>When dealing with state and DOM updates within components, there are to main methods of approaching this;</p><ol><li><p>Re-render everything as a pure function, and compare the outcome to detect what DOM updates are needed. This is how React approaches it.</p></li><li><p>Make your state reactive, and only apply specific updates when that specific data changes. This is how Vue/Mobx/Knockout and others approach it.</p></li></ol><p>The advantage of the reactive approach is that the main thing we do is <em>changing</em> the dom (instead of creating it), so what we&#39;re looking for is when changes happen - which is exactly what reactivity is made for.</p><p>However, it can become tricky when you have to pass reactive values around - you always have to think; if I do this, will it lose its reactivity? It can create quite some overhead, both mentally and in code.</p><p>This is where pure render function can make things simpler; with a given start state (the HTML that exists), we run our component function. The output it produces are the DOM changes that should be made. If we need to react on user interactions through events, we change our internal state. That change causes a re-execution of our function, resulting in new or updated Dom changes as output. Or, it can undo a previous change that was done.</p><p>After each execution, we can diff the previous list of change instructions to the current one, and the difference in that can be applied to the DOM.</p><h2 id="register-state-changes" tabindex="-1"><a class="header-anchor" href="#register-state-changes" aria-hidden="true">#</a> Register &quot;state changes&quot;</h2><p>Let&#39;s see how that concept could work, using react hooks for the internal data structure. Let&#39;s assume we get our props and refs from the outside.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Item</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> refs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// props.count would be our starting count, grabbed from the attributes</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>count <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// use a toggle hook to toggle between active and not active</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isActive<span class="token punctuation">,</span> toggleActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useToggle</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>isActive <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// when clicked on a button, we update our internal count</span>
  <span class="token comment">// this will cause our function to re-execute</span>
  <span class="token function">useEvent</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>button<span class="token punctuation">,</span> <span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// listen for our toggle change</span>
  <span class="token function">useEvent</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>toggle<span class="token punctuation">,</span> <span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// switch the toggle, which will cause this function to re-render.</span>
    <span class="token function">toggleActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// we could probably reguster useCallbacks here, and add the click binding in the below list, but that feels like</span>
  <span class="token comment">// we&#39;re duplicating things, without adding much value  </span>

  <span class="token comment">// this could register all our bindings that we ever want to change for out component</span>
  <span class="token comment">// basically, it&#39;s just a small part of a template engine, represending only the parts that we want to change </span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token function">registerState</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>button<span class="token punctuation">,</span> <span class="token string">&#39;text&#39;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">registerState</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>status<span class="token punctuation">,</span> <span class="token string">&#39;css&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&#39;is-active&#39;</span><span class="token operator">:</span> isActive<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>The &quot;DOM changes&quot; that were mentioned earlier don&#39;t really work well, since you never know when to return what. You don&#39;t want to detect changes internally and register changes from there. You just want to output the state as you know it, and let the framework do the rest. That&#39;s why each component pass should always return the same list of &quot;potential&quot; changes. On initial execution, the output of the render should exactly match with the current DOM.</p><p>Only when starting to react to changes, will our list start to contain actual changes.</p><h2 id="using-jsx" tabindex="-1"><a class="header-anchor" href="#using-jsx" aria-hidden="true">#</a> Using JSX</h2><p>Instead of returning a list of state &quot;changes&quot;, what if we could return JSX, just like in react? But instead of rendering the full Component which already exists in HTML, let&#39;s just render the part we&#39;re interested in. The only rule is that we can only return nodes that have a unique <code>ref</code> assigned to them, so they can be matched up with the existing HTML.</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">Item</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> refs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>count <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isActive<span class="token punctuation">,</span> toggleActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useToggle</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>isActive <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>status<span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token string-property property">&#39;is-active&#39;</span><span class="token operator">:</span> isActive<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>toggle<span class="token punctuation">}</span></span> <span class="token attr-name">click</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>toggleActive<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>button<span class="token punctuation">}</span></span> <span class="token attr-name">text</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">}</span></span> <span class="token attr-name">click</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Since it&#39;s JSX, we could use nesting to mimic our actual DOM, making it easier to locate where certain elements are. Most likely we won&#39;t even use that information when registering the change-list and do the diffing, but we could apply some validation and warn if it doesn&#39;t match up.</p><h2 id="appending-new-html" tabindex="-1"><a class="header-anchor" href="#appending-new-html" aria-hidden="true">#</a> Appending new HTML</h2><p>The only thing we can&#39;t do yet, is introduce new elements, or remove any existing ones.</p><p>Adding new elements could be done by a special node that can inject new JSX into an existing container:</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">Item</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> refs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>container2<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token comment">/* append the content within here at the bottom, which is the default behaviour */</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Append</span></span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>your value here<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Append</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>container1<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token comment">/* or append at the top */</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Append</span></span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>your value here<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Append</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>container2<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token comment">/* or below an existing ref, or above, or at an index, etc */</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Append</span></span> <span class="token attr-name">below</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>item<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>your value here<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Append</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>The tricky part of the above, is that we are communicating mutations, not state. We don&#39;t want to execute the mutation on each render, but just once if it&#39;s there. And on a next render, we might conditionally hide the <code>&lt;Append&gt;</code> node, which indicates that it should be removed again.</p><p>Maybe, instead of calling it <code>Append</code>, we should treat it as an <code>exact</code> slot. A piece in the HTML we only control from our component, just like actual react. We just need to make sure to specify that exact location. Which could be either replacing an existing DOM item (which is there as placeholder), rendering inside it (if it was empty), or at a specific position in an existing NodeList. That might actually work.</p><p>That &quot;portal&quot; that we register, could actually be managed by (p)react itself if we could allow for importing existing components in here. The only downside is that the hooks are not compatible between muban and (p)react components.</p><h3 id="removal-and-conditional-rendering" tabindex="-1"><a class="header-anchor" href="#removal-and-conditional-rendering" aria-hidden="true">#</a> Removal and conditional rendering</h3><p>The removal part is a bit trickier. Removal could ally to complete elements (which is irreversible), or attributes on existing HTML elements.</p><p>We could set up a rule that whatever we want to remove, should have existind before, so it can be picked up by our diffing algorithm. For complete elements, that would just mean the ref. For attributes, it should be the attribute with its value the way it is rendered in the HTML. Then, whenever we conditionally <em>not</em> render that part, we know we must remove it. And when rendering it again later, we can add it again (except for DOM nodes, unless we choose to keep them in memory, but just detached?).</p><p>If we won&#39;t revert DOM removal, we&#39;ll have to throw errors on any nested &quot;changes&quot; that are returned after that moment, which should be fine.</p><h4 id="merging-attribute-values" tabindex="-1"><a class="header-anchor" href="#merging-attribute-values" aria-hidden="true">#</a> Merging attribute values</h4>`,28),k=a('In some cases, most notable CSS classes, multiple values can exist in the attribute. Some values might exist in the original HTML, while we want to only conditionally add additional ones. These types of attributes should have the original and "managed" values merged in the end result. It could even be the case that those attributes are all managed by the '),h={href:"https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList",target:"_blank",rel:"noopener noreferrer"},d=a("DOMTokenList"),g=a(" API, which should make this relatively straightforward."),m=n("h2",{id:"tbc",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#tbc","aria-hidden":"true"},"#"),a(" TBC")],-1),b=n("p",null,'Even though the developer interface of such pure components are quite simple, there is more to be explored around the JSX, diffing and DOM mutation layer. And of course, the "portal" feature to add and manage new HTML into the dom.',-1);function w(f,v){const s=t("ExternalLinkIcon");return e(),p(c,null,[r,n("p",null,[k,n("a",h,[d,o(s)]),g]),m,b],64)}var q=u(i,[["render",w]]);export{q as default};
